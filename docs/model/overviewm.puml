@startuml

title DTT Particle Simulation Overview (stacked, minimal arrows)

top to bottom direction
skinparam wrapWidth 200

package "force backend" as forcePkg {
    interface ForceEngine
    class CpuTreeOmpForce
    class MpiTreeForce
    class CudaTreeForce <<optional>>
}

package "integrator" as integPkg {
    interface Integrator
    class EulerIntegrator
}

package "app" as appPkg {
    class SimulationRunner
    class SimulationConfig
}

package "tree" as treePkg {
    class Tree
    class TreeWorkspace
}

package "core" as corePkg {
    class ParticlesBuf
    class ForceBuf
}

package "comm (MPI)" as commPkg {
    class CommContext
}

package "io" as ioPkg {
    class VtkWriter <<optional>>
}

ForceEngine <|.. CpuTreeOmpForce
ForceEngine <|.. MpiTreeForce
ForceEngine <|.. CudaTreeForce
Integrator <|.. EulerIntegrator

SimulationRunner *-- SimulationConfig : «owns»
SimulationRunner --> ForceEngine : «strategy»
SimulationRunner --> Integrator : «stepper»
SimulationRunner ..> VtkWriter : «IO»

appPkg ..> forcePkg
appPkg ..> integPkg
forcePkg ..> treePkg
treePkg ..> corePkg
commPkg ..> corePkg
integPkg ..> corePkg
ioPkg ..> corePkg

@enduml
